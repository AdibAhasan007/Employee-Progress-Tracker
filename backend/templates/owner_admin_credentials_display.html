{% extends "base.html" %}
{% load static %}

{% block title %}Admin Credentials Reset - {{ company.name }}{% endblock %}

{% block content %}
<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Success Banner -->
            <div class="alert alert-success alert-dismissible fade show" role="alert" style="border-left: 5px solid #28a745;">
                <i class="fas fa-check-circle me-2"></i>
                <strong>‚úÖ Credentials Successfully Reset!</strong>
                <p class="mb-0 mt-2">New admin credentials have been generated for <strong>{{ company.name }}</strong>. Share these securely with the admin.</p>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Company Info Card -->
            <div class="card mb-4" style="border-top: 4px solid #667eea;">
                <div class="card-header bg-white py-3">
                    <h4 class="mb-0"><i class="fas fa-building me-2" style="color: #667eea;"></i>Company Information</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <p><strong>Company Name:</strong><br>{{ company.name }}</p>
                            <p><strong>Company Email:</strong><br>{{ company.email|default:"Not provided" }}</p>
                        </div>
                        <div class="col-md-4">
                            <p><strong>Status:</strong><br><span class="badge bg-info">{{ company.get_status_display }}</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Credentials Card -->
            <div class="card mb-4" style="border-top: 4px solid #764ba2;">
                <div class="card-header bg-white py-3">
                    <h4 class="mb-0"><i class="fas fa-key me-2" style="color: #764ba2;"></i>New Admin Credentials</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-success mb-4">
                        <i class="fas fa-check me-2"></i>
                        These are the NEW credentials. The old password is no longer valid.
                    </div>

                    <!-- Username -->
                    <div class="form-group mb-4">
                        <label class="form-label"><strong>Admin Username</strong></label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="admin-username" value="{{ admin_username }}" readonly style="background-color: #f8f9fa;">
                            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('admin-username')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="form-group mb-4">
                        <label class="form-label"><strong>Admin Email</strong></label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="admin-email" value="{{ admin_email }}" readonly style="background-color: #f8f9fa;">
                            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('admin-email')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>

                    <!-- New Password -->
                    <div class="form-group mb-4">
                        <label class="form-label"><strong>üÜï NEW Password</strong></label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="admin-password" value="{{ admin_password }}" readonly style="background-color: #f8f9fa;">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility()">
                                <i class="fas fa-eye" id="toggle-eye"></i>
                            </button>
                            <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard('admin-password')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                            <i class="fas fa-warning me-1" style="color: #ff6b6b;"></i>
                            <strong>This is the only time this password is shown!</strong> Save it securely.
                        </small>
                    </div>
                </div>
            </div>

            <!-- How to Login Card -->
            <div class="card mb-4" style="border-top: 4px solid #17a2b8;">
                <div class="card-header bg-white py-3">
                    <h4 class="mb-0"><i class="fas fa-sign-in-alt me-2" style="color: #17a2b8;"></i>How to Login</h4>
                </div>
                <div class="card-body">
                    <ol>
                        <li class="mb-3">
                            Go to the admin login page:<br>
                            <code style="background-color: #f8f9fa; padding: 8px 12px; border-radius: 4px;">
                                {{ request.scheme }}://{{ request.get_host }}/login/
                            </code>
                        </li>
                        <li class="mb-3">
                            Enter the new credentials:
                            <ul style="margin-top: 8px;">
                                <li><strong>Username:</strong> {{ admin_username }}</li>
                                <li><strong>Password:</strong> (from above)</li>
                            </ul>
                        </li>
                        <li>
                            Click <strong>Sign In</strong>
                        </li>
                        <li class="mt-3">
                            <strong>Recommended:</strong> Change the password on first login for security
                        </li>
                    </ol>
                </div>
            </div>

            <!-- Share Instructions Card -->
            <div class="card mb-4" style="border-top: 4px solid #ff9800;">
                <div class="card-header bg-white py-3">
                    <h4 class="mb-0"><i class="fas fa-share-alt me-2" style="color: #ff9800;"></i>How to Share Safely</h4>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-lock me-2"></i>
                        <strong>Security Tips:</strong>
                        <ul class="mb-0 mt-2">
                            <li>‚ùå <strong>DO NOT</strong> send credentials in plain email</li>
                            <li>‚úÖ Use encrypted email or secure password manager</li>
                            <li>‚úÖ Share username and password separately</li>
                            <li>‚úÖ Use a tool like LastPass, 1Password, or ProtonMail</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex gap-2 mb-4">
                <a href="{% url 'owner-dashboard' %}" class="btn btn-primary" style="background: linear-gradient(90deg, #667eea, #764ba2); border: none;">
                    <i class="fas fa-arrow-left me-2"></i> Back to Dashboard
                </a>
                <button class="btn btn-success" onclick="printCredentials()">
                    <i class="fas fa-print me-2"></i> Print Credentials
                </button>
            </div>

            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                The admin can now use these credentials to log in and manage employees.
            </div>
        </div>
    </div>
</div>

<script>
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    element.select();
    document.execCommand('copy');
    
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
    btn.classList.add('btn-success');
    btn.classList.remove('btn-outline-secondary');
    
    setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.classList.remove('btn-success');
        btn.classList.add('btn-outline-secondary');
    }, 2000);
}

function togglePasswordVisibility() {
    const passwordInput = document.getElementById('admin-password');
    const toggleEye = document.getElementById('toggle-eye');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleEye.classList.remove('fa-eye');
        toggleEye.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        toggleEye.classList.remove('fa-eye-slash');
        toggleEye.classList.add('fa-eye');
    }
}

function printCredentials() {
    const printWindow = window.open('', '', 'width=700,height=600');
    const content = `
        <!DOCTYPE html>
        <html>
        <head>
            <title>Admin Credentials - {{ company.name }}</title>
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
            <style>
                body { padding: 20px; font-family: Arial, sans-serif; }
                .credentials-box { 
                    border: 2px solid #667eea; 
                    padding: 20px; 
                    border-radius: 8px;
                    margin: 20px 0;
                    background-color: #f8f9fa;
                }
                .credential-item {
                    margin: 15px 0;
                    padding: 10px;
                    background: white;
                    border-left: 4px solid #667eea;
                }
                .credential-label {
                    font-weight: bold;
                    color: #333;
                    font-size: 12px;
                    text-transform: uppercase;
                }
                .credential-value {
                    font-family: monospace;
                    font-size: 16px;
                    margin-top: 5px;
                }
                .warning-box {
                    background: #fff3cd;
                    border: 1px solid #ffc107;
                    padding: 15px;
                    border-radius: 4px;
                    margin: 20px 0;
                }
                .footer {
                    margin-top: 30px;
                    font-size: 12px;
                    color: #666;
                    border-top: 1px solid #ddd;
                    padding-top: 15px;
                }
            </style>
        </head>
        <body>
            <h2>Admin Credentials Reset</h2>
            <p><strong>Company:</strong> {{ company.name }}</p>
            <p><strong>Date:</strong> ${new Date().toLocaleString()}</p>
            
            <div class="warning-box">
                <strong>‚ö†Ô∏è IMPORTANT:</strong> These are NEW credentials. The old password is no longer valid.
            </div>
            
            <div class="credentials-box">
                <div class="credential-item">
                    <div class="credential-label">Username</div>
                    <div class="credential-value">{{ admin_username }}</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">Email</div>
                    <div class="credential-value">{{ admin_email }}</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">üÜï New Password</div>
                    <div class="credential-value">{{ admin_password }}</div>
                </div>
            </div>
            
            <h4>Login Instructions</h4>
            <ol>
                <li>Go to: {{ request.scheme }}://{{ request.get_host }}/login/</li>
                <li>Enter the username and new password above</li>
                <li>Click Sign In</li>
                <li>Change the password on first login (recommended)</li>
            </ol>
            
            <div class="footer">
                <p><strong>Security:</strong> Share this securely (encrypted email, password manager, etc.)</p>
                <p>This document should be destroyed after credentials are securely shared.</p>
            </div>
        </body>
        </html>
    `;
    
    printWindow.document.write(content);
    printWindow.document.close();
    printWindow.print();
}
</script>
{% endblock %}
