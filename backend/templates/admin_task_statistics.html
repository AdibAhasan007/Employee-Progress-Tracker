{% extends 'base.html' %}
{% load static %}

{% block title %}Task Statistics - Admin Dashboard{% endblock %}

{% block extra_css %}
<style>
    .stats-container {
        padding: 20px;
        background: #f5f5f5;
        min-height: 100vh;
    }

    .stats-header {
        margin-bottom: 30px;
    }

    .stats-header h1 {
        margin: 0 0 10px 0;
        color: #333;
        font-size: 28px;
    }

    .stats-header p {
        margin: 0;
        color: #666;
        font-size: 14px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-box {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-left: 5px solid #667eea;
    }

    .stat-box.primary {
        border-left-color: #667eea;
    }

    .stat-box.pending {
        border-left-color: #ff9800;
    }

    .stat-box.in-progress {
        border-left-color: #2196f3;
    }

    .stat-box.completed {
        border-left-color: #4caf50;
    }

    .stat-box-value {
        font-size: 36px;
        font-weight: bold;
        color: #333;
        margin: 0;
    }

    .stat-box-label {
        font-size: 13px;
        color: #999;
        margin: 8px 0 0 0;
        text-transform: uppercase;
    }

    .stat-box-percentage {
        font-size: 13px;
        color: #667eea;
        margin: 5px 0 0 0;
        font-weight: 600;
    }

    .charts-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .chart-card {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chart-card h3 {
        margin: 0 0 20px 0;
        color: #333;
        font-size: 18px;
    }

    .progress-item {
        margin-bottom: 20px;
    }

    .progress-item-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .progress-item-name {
        color: #333;
        font-weight: 600;
    }

    .progress-item-count {
        color: #999;
    }

    .progress-bar {
        width: 100%;
        height: 20px;
        background: #f0f0f0;
        border-radius: 10px;
        overflow: hidden;
    }

    .progress-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        border-radius: 10px;
        transition: width 0.3s ease;
    }

    .legend {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #eee;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
    }

    .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 2px;
    }

    .employees-table {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .employees-table h3 {
        margin: 0 0 20px 0;
        color: #333;
        font-size: 18px;
    }

    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table thead {
        background: #f9f9f9;
        border-bottom: 2px solid #eee;
    }

    .table th {
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: #333;
        font-size: 13px;
    }

    .table td {
        padding: 12px;
        border-bottom: 1px solid #eee;
        font-size: 13px;
    }

    .table tbody tr:hover {
        background: #f9f9f9;
    }

    .employee-name {
        font-weight: 600;
        color: #333;
    }

    .status-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: bold;
    }

    .status-badge.pending {
        background: #fff3cd;
        color: #856404;
    }

    .status-badge.in-progress {
        background: #cfe8fc;
        color: #004085;
    }

    .status-badge.completed {
        background: #d4edda;
        color: #155724;
    }

    .mini-bar {
        display: flex;
        gap: 4px;
        height: 20px;
    }

    .mini-bar-segment {
        border-radius: 2px;
        font-size: 9px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    }

    .mini-bar-segment.pending {
        background: #ff9800;
    }

    .mini-bar-segment.in-progress {
        background: #2196f3;
    }

    .mini-bar-segment.completed {
        background: #4caf50;
    }

    .occupancy-stats {
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }

    .occupancy-stats h3 {
        margin: 0 0 20px 0;
        color: #333;
        font-size: 18px;
    }

    .occupancy-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
    }

    .occupancy-item {
        text-align: center;
    }

    .occupancy-chart {
        width: 120px;
        height: 120px;
        margin: 0 auto 15px;
        position: relative;
        border-radius: 50%;
        background: conic-gradient(
            #4caf50 0deg calc(var(--active-angle)),
            #ff9800 calc(var(--active-angle)) calc(calc(var(--active-angle) + var(--idle-angle))),
            #999 calc(calc(var(--active-angle) + var(--idle-angle))) 360deg
        );
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .occupancy-center {
        width: 100px;
        height: 100px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #333;
    }

    .occupancy-percentage {
        font-size: 20px;
        font-weight: bold;
    }

    .occupancy-label {
        font-size: 12px;
        color: #999;
        margin-top: 5px;
    }

    @media (max-width: 1024px) {
        .charts-grid {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .occupancy-grid {
            grid-template-columns: 1fr;
        }

        .table {
            font-size: 12px;
        }

        .table th,
        .table td {
            padding: 8px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="stats-container">
    <div class="stats-header">
        <h1>ðŸ“Š Task Statistics & Analytics</h1>
        <p>Comprehensive overview of task completion, productivity, and employee performance</p>
    </div>

    <!-- Key Statistics -->
    <div class="stats-grid">
        <div class="stat-box primary">
            <p class="stat-box-value">{{ total_tasks }}</p>
            <p class="stat-box-label">Total Tasks</p>
        </div>
        <div class="stat-box completed">
            <p class="stat-box-value">{{ completed_tasks }}</p>
            <p class="stat-box-label">Completed</p>
            <p class="stat-box-percentage">{{ completion_rate }}% completion rate</p>
        </div>
        <div class="stat-box in-progress">
            <p class="stat-box-value">{{ in_progress_tasks }}</p>
            <p class="stat-box-label">In Progress</p>
        </div>
        <div class="stat-box pending">
            <p class="stat-box-value">{{ pending_tasks }}</p>
            <p class="stat-box-label">Pending</p>
        </div>
    </div>

    <!-- Occupancy Statistics -->
    <div class="occupancy-stats">
        <h3>ðŸ‘¥ Employee Occupancy (Last 24 Hours)</h3>
        <div class="occupancy-grid">
            <div class="occupancy-item">
                <div class="occupancy-chart" style="--active-angle: {{ active_ratio }}deg; --idle-angle: {{ idle_ratio }}deg;">
                    <div class="occupancy-center">
                        <div style="text-align: center;">
                            <div class="occupancy-percentage">{{ active_ratio|floatformat:0 }}%</div>
                            <div style="font-size: 12px; color: #999;">Active</div>
                        </div>
                    </div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #4caf50;"></div>
                        <span>Active: {{ active_ratio|floatformat:1 }}%</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff9800;"></div>
                        <span>Idle: {{ idle_ratio|floatformat:1 }}%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
        <!-- Task Distribution -->
        <div class="chart-card">
            <h3>ðŸ“ˆ Task Status Distribution</h3>
            
            <div class="progress-item">
                <div class="progress-item-label">
                    <span class="progress-item-name">Pending Tasks</span>
                    <span class="progress-item-count">{{ pending_count }}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: {% widthratio pending_count total_tasks 100 %}%; background: #ff9800;"></div>
                </div>
            </div>

            <div class="progress-item">
                <div class="progress-item-label">
                    <span class="progress-item-name">In Progress</span>
                    <span class="progress-item-count">{{ in_progress_count }}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: {% widthratio in_progress_count total_tasks 100 %}%; background: #2196f3;"></div>
                </div>
            </div>

            <div class="progress-item">
                <div class="progress-item-label">
                    <span class="progress-item-name">Completed</span>
                    <span class="progress-item-count">{{ completed_count }}</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: {% widthratio completed_count total_tasks 100 %}%; background: #4caf50;"></div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff9800;"></div>
                    <span>Pending</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196f3;"></div>
                    <span>In Progress</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4caf50;"></div>
                    <span>Completed</span>
                </div>
            </div>
        </div>

        <!-- Progress Distribution -->
        <div class="chart-card">
            <h3>ðŸ“Š Task Progress Distribution</h3>
            
            {% for range, count in progress_ranges.items %}
            <div class="progress-item">
                <div class="progress-item-label">
                    <span class="progress-item-name">{{ range }}</span>
                    <span class="progress-item-count">{{ count }} tasks</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: {% widthratio count total_tasks 100 %}%;"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Employee Performance Table -->
    <div class="employees-table">
        <h3>ðŸ‘¤ Employee Task Performance</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Employee Name</th>
                    <th style="text-align: center;">Total Assigned</th>
                    <th style="text-align: center;">Completed</th>
                    <th style="text-align: center;">In Progress</th>
                    <th style="text-align: center;">Pending</th>
                    <th>Task Distribution</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employee_stats %}
                <tr>
                    <td class="employee-name">{{ emp.name }}</td>
                    <td style="text-align: center;">
                        <span class="status-badge" style="background: #f0f0f0; color: #333;">
                            {{ emp.total_assigned }}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        <span class="status-badge completed">{{ emp.completed }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="status-badge in-progress">{{ emp.in_progress }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="status-badge pending">{{ emp.pending }}</span>
                    </td>
                    <td>
                        <div class="mini-bar">
                            {% if emp.completed > 0 %}
                            <div class="mini-bar-segment completed" style="width: {% widthratio emp.completed emp.total_assigned 100 %}%;"></div>
                            {% endif %}
                            {% if emp.in_progress > 0 %}
                            <div class="mini-bar-segment in-progress" style="width: {% widthratio emp.in_progress emp.total_assigned 100 %}%;"></div>
                            {% endif %}
                            {% if emp.pending > 0 %}
                            <div class="mini-bar-segment pending" style="width: {% widthratio emp.pending emp.total_assigned 100 %}%;"></div>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
